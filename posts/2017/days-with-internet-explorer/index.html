<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>與 IE 相處的日子 | Life is a refactoring process without tests</title>
<meta name=keywords content="Internet Explorer,Front-end,JavaScript,Web Compatibility,Browser Testing"><meta name=description content="近幾年來，JavaScript 可謂風生水起，從後端到前端，從 mobile 到 desktop，各種 module 滿天飛，信手拈來就是一個 web app。不過，「沒碰過 IE，"><meta name=author content><link rel=canonical href=https://weihanglo.tw/posts/2017/days-with-internet-explorer/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://weihanglo.tw/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://weihanglo.tw/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://weihanglo.tw/favicon-32x32.png><link rel=apple-touch-icon href=https://weihanglo.tw/apple-touch-icon.png><link rel=mask-icon href=https://weihanglo.tw/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://weihanglo.tw/posts/2017/days-with-internet-explorer/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><meta property="og:title" content="與 IE 相處的日子"><meta property="og:description" content="近幾年來，JavaScript 可謂風生水起，從後端到前端，從 mobile 到 desktop，各種 module 滿天飛，信手拈來就是一個 web app。不過，「沒碰過 IE，"><meta property="og:type" content="article"><meta property="og:url" content="https://weihanglo.tw/posts/2017/days-with-internet-explorer/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-07-15T11:36:04+08:00"><meta property="article:modified_time" content="2017-07-15T11:36:04+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="與 IE 相處的日子"><meta name=twitter:description content="近幾年來，JavaScript 可謂風生水起，從後端到前端，從 mobile 到 desktop，各種 module 滿天飛，信手拈來就是一個 web app。不過，「沒碰過 IE，"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://weihanglo.tw/posts/"},{"@type":"ListItem","position":2,"name":"與 IE 相處的日子","item":"https://weihanglo.tw/posts/2017/days-with-internet-explorer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"與 IE 相處的日子","name":"與 IE 相處的日子","description":"近幾年來，JavaScript 可謂風生水起，從後端到前端，從 mobile 到 desktop，各種 module 滿天飛，信手拈來就是一個 web app。不過，「沒碰過 IE，","keywords":["Internet Explorer","Front-end","JavaScript","Web Compatibility","Browser Testing"],"articleBody":" 近幾年來，JavaScript 可謂風生水起，從後端到前端，從 mobile 到 desktop，各種 module 滿天飛，信手拈來就是一個 web app。不過，「沒碰過 IE，別說你會做前端」，本人從超新手的角度出發，整理最近修正 IE 相容性遇到的坑與解法，給自己日後留個參考。\n（撰於 2017-07-15，基於 IE 11／Edge 15）\nContents Issues Fullscreen breaks my layout! Can an image fit its container with aspect ratio? Do you know your id? Where are my children? Give me some animated SVG How an element removes itself? Same CSS, weird flexbox behavior (EXTRA) Read the fxxking standard before using custom elements Tools for dealing with compatible issues Compatible tables Cross browser testing services Virtual machines Conclusion Issues Fullscreen breaks my layout! Issue：使用 Web fullscreen API 放大至全螢幕時，整個 document 寬度剩不到一半。 Platform：IE 11 第一個先來簡單的 fullscreen API！雖然 fullscreen API 還沒有去掉 prefix，不過這個 bug 說實在也太大了！沒關係，加個 width 解決，簡單明瞭！\nhtml { min-width: 100%; } Can an image fit its container with aspect ratio? Issue：沒實作 object-fit、object-position 這兩個 CSS feature。 Platform：IE 11／Edge 15（據說 Edge 16 實作了？） IE 沒支援一直是 object-fit 的一大硬傷，許多 polyfill 也做得不是很完全，但我們還有歷久不衰的 background style，善用 background-size 與 background-position 就可以做到這些效果。\n需注意的是，background options 並沒有 onload 的 callback，許多 progressive image loading 效果可能無法使用。我們可以利用一個 detached element 先讀取圖檔至 memory， onload 時再 assign 到 backgroundImage 中，雖然這樣有點醜，反正你都要 call onload 了，是有差醜這點喔 XD\nvar preload = new Image() preload.onload = function () { var real = document.querySelector('img') real.backgroundImage = `url(\"${preload.src}\")` } preload.src = 'uri/to/a/large/image' Do you know your id? Issue：XMLDocument 缺乏 Element#id 的 API。 Platform：IE 11／Edge 15 也就是說，id attribute 對 IE 們來說，並非特殊的 property，僅為普通的 attribute，所以 ID selector #someid，或是 someElement.id 這類 API 通通不能用。\n解法嗎？用 attribute 代替啊！\nimage#myid { display: none; } /* become */ image[id=\"myid\"] { display: none; } document.querySelector('img').id /* become */ document.querySelector('img').getAttribute('id') Where are my children? Issue：XMLDocument 缺乏 Element#children 的 getter API。 Platform：IE 11／Edge 15 這 Issue 滿討厭的，通常我們只想取得 Element，在 IE 卻被迫遍歷 childNodes 過濾出 nodeType === 1 的 node。MDN 上有可用的 polyfill，但本人每次跑 mocha 測試都會拋出 Illegal Invocation，看起來是 this.childNodes getter 的 this binding 錯誤？有點莫名，只好稍微繞點路修改一下，反正都做 polyfill 了，不差這些醜 code。以下做個參考：\n// Node#children/Element#children polyfill (for Edge 15, IE 11) // // From: https://developer.mozilla.org/en-US/docs/Web/API/ParentNode/children // Overwrites native 'children' prototype. // Adds Document \u0026 DocumentFragment support for IE9 \u0026 Safari. // Returns array instead of HTMLCollection. ;(function (constructor) { function childNodesProp (prototype) { return Object.getOwnPropertyDescriptor(prototype, 'childNodes') } if (constructor \u0026\u0026 constructor.prototype \u0026\u0026 !constructor.prototype.hasOwnProperty('children')) { Object.defineProperty(constructor.prototype, 'children', { get: function () { var i = 0 var node var nodesProp = childNodesProp(constructor.prototype) || childNodesProp(Object.getPrototypeOf(constructor.prototype)) var nodes = nodesProp.get.call(this) var children = [] while (node = nodes[i++]) { if (node.nodeType === 1) { children.push(node) } } return children } }) } })(/* window.Node || */ window.Element) // 加 `Node` 是給 SVG 使用，on demand 囉 Give me some animated SVG Issue：IE 們沒有實作 SVG SMIL animation。 Platform：IE 11／Edge 15 雖然說被偉大的 Google 給 deprecate 了，但也遭受不少反彈聲音，在 Web animation API 還沒普及之前，我們可以利用 inline css animation 來實現簡單的動畫效果。例如無腦的的 loading（首次親手寫 SVG，獻醜了）。\n順便提一下，Edge/IE 的 CSS transform 並不支援 SVG，僅能透過 transform attribute 來達成效果。Poor IE！\n","wordCount":"2850","inLanguage":"en","datePublished":"2017-07-15T11:36:04+08:00","dateModified":"2017-07-15T11:36:04+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://weihanglo.tw/posts/2017/days-with-internet-explorer/"},"publisher":{"@type":"Organization","name":"Life is a refactoring process without tests","logo":{"@type":"ImageObject","url":"https://weihanglo.tw/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://weihanglo.tw/ accesskey=h title="Life is a refactoring process without tests (Alt + H)">Life is a refactoring process without tests</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://weihanglo.tw/ title=Home><span>Home</span></a></li><li><a href=https://weihanglo.tw/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://weihanglo.tw/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://weihanglo.tw/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">與 IE 相處的日子</h1><div class=post-meta><span title='2017-07-15 11:36:04 +0800 +0800'>July 15, 2017</span>&nbsp;·&nbsp;6 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#contents aria-label=Contents>Contents</a></li><li><a href=#issues aria-label=Issues>Issues</a><ul><li><a href=#fullscreen-breaks-my-layout aria-label="Fullscreen breaks my layout!">Fullscreen breaks my layout!</a></li><li><a href=#can-an-image-fit-its-container-with-aspect-ratio aria-label="Can an image fit its container with aspect ratio?">Can an image fit its container with aspect ratio?</a></li><li><a href=#do-you-know-your-id aria-label="Do you know your id?">Do you know your id?</a></li><li><a href=#where-are-my-children aria-label="Where are my children?">Where are my children?</a></li><li><a href=#give-me-some-animated-svg aria-label="Give me some animated SVG">Give me some animated SVG</a></li><li><a href=#how-an-element-removes-itself aria-label="How an element removes itself?">How an element removes itself?</a></li><li><a href=#same-css-weird-flexbox-behavior aria-label="Same CSS, weird flexbox behavior">Same CSS, weird flexbox behavior</a></li><li><a href=#extra-read-the-fxxking-standard-before-using-custom-elements aria-label="(EXTRA) Read the fxxking standard before using custom elements">(EXTRA) Read the fxxking standard before using custom elements</a></li></ul></li><li><a href=#tools-for-dealing-with-compatible-issues aria-label="Tools for dealing with compatible issues">Tools for dealing with compatible issues</a><ul><li><a href=#compatible-tables aria-label="Compatible tables">Compatible tables</a></li><li><a href=#cross-browser-testing-services aria-label="Cross browser testing services">Cross browser testing services</a></li><li><a href=#virtual-machines aria-label="Virtual machines">Virtual machines</a></li></ul></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><p><img loading=lazy src=https://i.imgur.com/VEgmWpv.jpg alt></p><p>近幾年來，JavaScript 可謂風生水起，從後端到前端，從 mobile 到 desktop，各種 module 滿天飛，信手拈來就是一個 web app。不過，<strong>「沒碰過 IE，別說你會做前端」</strong>，本人從超新手的角度出發，整理最近修正 IE 相容性遇到的坑與解法，給自己日後留個參考。</p><p><em>（撰於 2017-07-15，基於 IE 11／Edge 15）</em></p><h2 id=contents>Contents<a hidden class=anchor aria-hidden=true href=#contents>#</a></h2><ul><li><a href=#Issues>Issues</a><ul><li><a href=#Fullscreen-breaks-my-layout>Fullscreen breaks my layout!</a></li><li><a href=#Can-an-image-fit-its-container-with-aspect-ratio>Can an image fit its container with aspect ratio?</a></li><li><a href=#Do-you-know-your-id>Do you know your <code>id</code>?</a></li><li><a href=#Where-are-my-children>Where are my <code>children</code>?</a></li><li><a href=#Give-me-some-animated-SVG>Give me some animated SVG</a></li><li><a href=#How-an-element-removes-itself>How an element removes itself?</a></li><li><a href=#Same-CSS-weird-flexbox-behavior>Same CSS, weird flexbox behavior</a></li><li><a href=#EXTRA-Read-the-fxxking-standard-before-using-custom-elements>(EXTRA) Read the fxxking standard before using custom elements</a></li></ul></li><li><a href=#Tools-for-dealing-with-compatible-issues>Tools for dealing with compatible issues</a><ul><li><a href=#Compatible-tables>Compatible tables</a></li><li><a href=#Cross-browser-testing-services>Cross browser testing services</a></li><li><a href=#Virtual-machines>Virtual machines</a></li></ul></li><li><a href=#Conclusion>Conclusion</a></li></ul><h2 id=issues>Issues<a hidden class=anchor aria-hidden=true href=#issues>#</a></h2><h3 id=fullscreen-breaks-my-layout>Fullscreen breaks my layout!<a hidden class=anchor aria-hidden=true href=#fullscreen-breaks-my-layout>#</a></h3><ul><li>Issue：使用 Web fullscreen API 放大至全螢幕時，整個 document 寬度剩不到一半。</li><li>Platform：IE 11</li></ul><p>第一個先來簡單的 fullscreen API！雖然 <a href="https://caniuse.com/#feat=fullscreen">fullscreen API 還沒有去掉 prefix</a>，不過這個 bug 說實在也太大了！沒關係，加個 width 解決，簡單明瞭！</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>html</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>min-width</span>: <span style=color:#ae81ff>100</span><span style=color:#66d9ef>%</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=can-an-image-fit-its-container-with-aspect-ratio>Can an image fit its container with aspect ratio?<a hidden class=anchor aria-hidden=true href=#can-an-image-fit-its-container-with-aspect-ratio>#</a></h3><ul><li>Issue：沒實作 <code>object-fit</code>、<code>object-position</code> 這兩個 CSS feature。</li><li>Platform：<a href="https://caniuse.com/#feat=object-fit">IE 11／Edge 15（據說 Edge 16 實作了？）</a></li></ul><p>IE 沒支援一直是 <code>object-fit</code> 的一大硬傷，許多 polyfill 也做得不是很完全，但我們還有歷久不衰的 <code>background</code> style，善用 <code>background-size</code> 與 <code>background-position</code> 就可以做到這些效果。</p><p>需注意的是，<code>background</code> options 並沒有 <code>onload</code> 的 callback，許多 progressive image loading 效果可能無法使用。我們可以利用一個 detached <code>&lt;img></code> element 先讀取圖檔至 memory， <code>onload</code> 時再 assign 到 <code>backgroundImage</code> 中，雖然這樣有點醜，反正你都要 call <code>onload</code> 了，是有差醜這點喔 XD</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>preload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Image</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>preload</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>real</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;img&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>real</span>.<span style=color:#a6e22e>backgroundImage</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`url(&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>preload</span>.<span style=color:#a6e22e>src</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;)`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>preload</span>.<span style=color:#a6e22e>src</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;uri/to/a/large/image&#39;</span>
</span></span></code></pre></div><h3 id=do-you-know-your-id>Do you know your <code>id</code>?<a hidden class=anchor aria-hidden=true href=#do-you-know-your-id>#</a></h3><ul><li>Issue：<code>XMLDocument</code> 缺乏 <code>Element#id</code> 的 API。</li><li>Platform：IE 11／Edge 15</li></ul><p>也就是說，<code>id</code> attribute 對 IE 們來說，並非特殊的 property，僅為普通的 attribute，所以 <strong>ID selector</strong> <code>#someid</code>，或是 <code>someElement.id</code> 這類 API 通通不能用。</p><p>解法嗎？用 attribute 代替啊！</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>image</span>#myid { <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>none</span>; }
</span></span><span style=display:flex><span><span style=color:#75715e>/* become */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>image</span><span style=color:#f92672>[</span><span style=color:#f92672>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;myid&#34;</span><span style=color:#f92672>]</span> { <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>none</span>; }
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;img&#39;</span>).<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* become */</span>
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;img&#39;</span>).<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#39;id&#39;</span>)
</span></span></code></pre></div><h3 id=where-are-my-children>Where are my <code>children</code>?<a hidden class=anchor aria-hidden=true href=#where-are-my-children>#</a></h3><ul><li>Issue：<code>XMLDocument</code> 缺乏 <code>Element#children</code> 的 getter API。</li><li>Platform：IE 11／Edge 15</li></ul><p>這 Issue 滿討厭的，通常我們只想取得 <code>Element</code>，在 IE 卻被迫遍歷 <code>childNodes</code> 過濾出 <code>nodeType === 1</code> 的 node。MDN 上有可用的 <a href=https://developer.mozilla.org/en-US/docs/Web/API/ParentNode/children#Polyfill>polyfill</a>，但本人每次跑 mocha 測試都會拋出 <code>Illegal Invocation</code>，看起來是 <code>this.childNodes</code> getter 的 <code>this</code> binding 錯誤？有點莫名，只好稍微繞點路修改一下，反正都做 polyfill 了，不差這些醜 code。以下做個參考：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Node#children/Element#children polyfill (for Edge 15, IE 11)
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// From: https://developer.mozilla.org/en-US/docs/Web/API/ParentNode/children
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Overwrites native &#39;children&#39; prototype.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Adds Document &amp; DocumentFragment support for IE9 &amp; Safari.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Returns array instead of HTMLCollection.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>;(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>constructor</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>childNodesProp</span> (<span style=color:#a6e22e>prototype</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Object.<span style=color:#a6e22e>getOwnPropertyDescriptor</span>(<span style=color:#a6e22e>prototype</span>, <span style=color:#e6db74>&#39;childNodes&#39;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>constructor</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>.<span style=color:#a6e22e>prototype</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>!</span><span style=color:#a6e22e>constructor</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>hasOwnProperty</span>(<span style=color:#e6db74>&#39;children&#39;</span>)) {
</span></span><span style=display:flex><span>    Object.<span style=color:#a6e22e>defineProperty</span>(<span style=color:#a6e22e>constructor</span>.<span style=color:#a6e22e>prototype</span>, <span style=color:#e6db74>&#39;children&#39;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>get</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>node</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nodesProp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>childNodesProp</span>(<span style=color:#a6e22e>constructor</span>.<span style=color:#a6e22e>prototype</span>) <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>childNodesProp</span>(Object.<span style=color:#a6e22e>getPrototypeOf</span>(<span style=color:#a6e22e>constructor</span>.<span style=color:#a6e22e>prototype</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nodes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>nodesProp</span>.<span style=color:#a6e22e>get</span>.<span style=color:#a6e22e>call</span>(<span style=color:#66d9ef>this</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>children</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>node</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>nodes</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>]) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>nodeType</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>children</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>node</span>)
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>children</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})(<span style=color:#75715e>/* window.Node || */</span> window.<span style=color:#a6e22e>Element</span>) <span style=color:#75715e>// 加 `Node` 是給 SVG 使用，on demand 囉
</span></span></span></code></pre></div><h3 id=give-me-some-animated-svg>Give me some animated SVG<a hidden class=anchor aria-hidden=true href=#give-me-some-animated-svg>#</a></h3><ul><li>Issue：IE 們沒有實作 SVG SMIL animation。</li><li>Platform：<a href="https://caniuse.com/#feat=svg-smil">IE 11／Edge 15</a></li></ul><p>雖然說被偉大的 Google 給 <a href=https://groups.google.com/a/chromium.org/forum/#!topic/blink-dev/5o0yiO440LM%5B126-150%5D>deprecate</a> 了，但也遭受不少反彈聲音，在 Web animation API 還沒普及之前，我們可以利用 <strong>inline css animation</strong> 來實現簡單的動畫效果。例如無腦的的 loading（首次親手寫 SVG，獻醜了）。</p><blockquote><p>順便提一下，Edge/IE 的 <a href="https://caniuse.com/#feat=transforms2d">CSS transform 並不支援 SVG</a>，僅能透過 transform attribute 來達成效果。Poor IE！</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-svg data-lang=svg><span style=display:flex><span><span style=color:#f92672>&lt;svg</span> <span style=color:#a6e22e>x=</span><span style=color:#e6db74>&#34;0px&#34;</span> <span style=color:#a6e22e>y=</span><span style=color:#e6db74>&#34;0px&#34;</span> <span style=color:#a6e22e>width=</span><span style=color:#e6db74>&#34;24px&#34;</span> <span style=color:#a6e22e>height=</span><span style=color:#e6db74>&#34;30px&#34;</span> <span style=color:#a6e22e>viewBox=</span><span style=color:#e6db74>&#34;0 0 20 20&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;style</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;text/css&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    rect {
</span></span><span style=display:flex><span>      transform-origin: center center;
</span></span><span style=display:flex><span>      animation: 0.5s animate infinite ease-in-out alternate;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    rect:nth-of-type(2) { animation-delay: 150ms; }
</span></span><span style=display:flex><span>    rect:nth-of-type(3) { animation-delay: 300ms; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @keyframes animate {
</span></span><span style=display:flex><span>      from { opacity: 0.2; transform: scaleY(1); }
</span></span><span style=display:flex><span>      to { opacity: 0.8; transform: scaleY(2); }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/style&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;rect</span> <span style=color:#a6e22e>x=</span><span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#a6e22e>y=</span><span style=color:#e6db74>&#34;5&#34;</span> <span style=color:#a6e22e>width=</span><span style=color:#e6db74>&#34;4&#34;</span> <span style=color:#a6e22e>height=</span><span style=color:#e6db74>&#34;10&#34;</span> <span style=color:#a6e22e>fill=</span><span style=color:#e6db74>&#34;#333&#34;</span> <span style=color:#a6e22e>opacity=</span><span style=color:#e6db74>&#34;0.2&#34;</span><span style=color:#f92672>&gt;&lt;/rect&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;rect</span> <span style=color:#a6e22e>x=</span><span style=color:#e6db74>&#34;8&#34;</span> <span style=color:#a6e22e>y=</span><span style=color:#e6db74>&#34;5&#34;</span> <span style=color:#a6e22e>width=</span><span style=color:#e6db74>&#34;4&#34;</span> <span style=color:#a6e22e>height=</span><span style=color:#e6db74>&#34;10&#34;</span> <span style=color:#a6e22e>fill=</span><span style=color:#e6db74>&#34;#333&#34;</span>  <span style=color:#a6e22e>opacity=</span><span style=color:#e6db74>&#34;0.2&#34;</span><span style=color:#f92672>&gt;&lt;/rect&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;rect</span> <span style=color:#a6e22e>x=</span><span style=color:#e6db74>&#34;16&#34;</span> <span style=color:#a6e22e>y=</span><span style=color:#e6db74>&#34;5&#34;</span> <span style=color:#a6e22e>width=</span><span style=color:#e6db74>&#34;4&#34;</span> <span style=color:#a6e22e>height=</span><span style=color:#e6db74>&#34;10&#34;</span> <span style=color:#a6e22e>fill=</span><span style=color:#e6db74>&#34;#333&#34;</span>  <span style=color:#a6e22e>opacity=</span><span style=color:#e6db74>&#34;0.2&#34;</span><span style=color:#f92672>&gt;&lt;/rect&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/svg&gt;</span>
</span></span></code></pre></div><h3 id=how-an-element-removes-itself>How an element removes itself?<a hidden class=anchor aria-hidden=true href=#how-an-element-removes-itself>#</a></h3><ul><li>Issue：IE 的 DOM Node 缺乏 <code>remove</code> method，無法自殺（<strong>自殺不能解決問題，珍惜生命，遠離 IE</strong>）</li><li>Platform：IE 11</li></ul><p>這個坑大大的掛在 <a href="https://caniuse.com/#feat=childnode-remove">Can I use</a> 裡，但也只有用到才會發現，如果你是 Mac 用戶，調試 IE 很辛苦，最後發現是這種狗屎 bug，這輩子鐵定再也不碰任何 M 社出品的玩意兒（結果卻用 VS Code 打這篇文章 XD）。</p><p>解法很簡單，如果 codebase 不大的話，將 <code>el.remove()</code> 改成 <code>el.parentNode.removeChild(el)</code> 即可輕鬆解決。如果你想本人一樣，最近工作上使用 <a href=https://www.webcomponents.org/>Web Components</a>，必須 import <a href=https://html.spec.whatwg.org/multipage/scripting.html#custom-elements>Custom Elements</a> 的 polyfill，寫了 support IE 11，卻<a href=https://github.com/webcomponents/custom-elements/blob/master/src/Patch/Interface/ChildNode.js#L104>偷偷調用 <code>remove</code> API</a>，你玩我嗎？</p><p>既然<a href=https://github.com/webcomponents/custom-elements/issues/103>官方沒有任何要修改的動靜</a>，自己加個 Polyfill 總行了吧？</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Element#remove polyfill (for IE 11)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// (MUST import before custom-elements polyfill)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// from:https://github.com/jserz/js_piece/blob/master/DOM/ChildNode/remove()/remove().md
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Issue discussion:https://github.com/webcomponents/custom-elements/issues/103
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>;(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>arr</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>arr</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>item</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>hasOwnProperty</span>(<span style=color:#e6db74>&#39;remove&#39;</span>)) { <span style=color:#66d9ef>return</span> }
</span></span><span style=display:flex><span>    Object.<span style=color:#a6e22e>defineProperty</span>(<span style=color:#a6e22e>item</span>, <span style=color:#e6db74>&#39;remove&#39;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>configurable</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>enumerable</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>writable</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>remove</span>() { <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>parentNode</span>.<span style=color:#a6e22e>removeChild</span>(<span style=color:#66d9ef>this</span>) }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>})([<span style=color:#a6e22e>Element</span>.<span style=color:#a6e22e>prototype</span>, <span style=color:#a6e22e>CharacterData</span>.<span style=color:#a6e22e>prototype</span>, <span style=color:#a6e22e>DocumentType</span>.<span style=color:#a6e22e>prototype</span>])
</span></span></code></pre></div><h3 id=same-css-weird-flexbox-behavior>Same CSS, weird flexbox behavior<a hidden class=anchor aria-hidden=true href=#same-css-weird-flexbox-behavior>#</a></h3><ul><li>Issue：各種 flexbox 的 bug</li><li>Platform：IE 11</li></ul><p>眾所週知，IE 的 <strong>flexbox</strong> 實現有許多 bug，本人也遇到不少，幸好碼農們也整理出 <a href=https://github.com/philipwalton/flexbugs>bug list</a> 供大家避坑，這裡就不多做解釋了。</p><h3 id=extra-read-the-fxxking-standard-before-using-custom-elements>(EXTRA) Read the fxxking standard before using custom elements<a hidden class=anchor aria-hidden=true href=#extra-read-the-fxxking-standard-before-using-custom-elements>#</a></h3><ul><li>Issue：在 custom elements connected 前，不要對他操作 DOM（appendChild、setAttribute）。</li><li>Platform：Chrome 54+</li></ul><p>這其實不算是 bug，而是一個標準，Chrome 實實在在地做出來了，<strong>polyfill</strong> 卻沒有檢查這些 requirements。根據 <a href=https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element-conformance>Custom elements constructor 的標準</a>，</p><blockquote><p>The element must not gain any attributes or children, as this violates the expectations of consumers who use the <code>createElement</code> or <code>createElementNS</code> methods.</p></blockquote><p>我們不能在 constructor 中有任何 attribute／childNodes 的操作，也不應涉及設計 render 相關動作，官方標準建議可以在 <code>constructor</code> 中做：</p><ul><li>Setup event listeners.</li><li>Setup default/initial values.</li><li>Setup <strong>shadow root</strong>.</li><li>Truly one-time initializaiton.（因為 <code>connectedCallback</code> 很可能跑不只一次）</li></ul><p>實務上，大部分的工作都會延遲到 <code>connectedCallback</code>，尤其當這個 elements 以互動／呈現為主，<code>constrcutor</code> 反而僅剩加 flag 防止二次渲染，以及一些 private field 的設定。</p><p>其實 web components 的 polyfill 坑也不少，希望未來有一天能夠普及（但 attribute 不能傳遞 function context 就難受想哭）。</p><h2 id=tools-for-dealing-with-compatible-issues>Tools for dealing with compatible issues<a hidden class=anchor aria-hidden=true href=#tools-for-dealing-with-compatible-issues>#</a></h2><p>為了相容各大瀏覽器，前端工程比想像中更加複雜，往往設計好一些 feature，卻因為相容性問題，被迫對架構做出修正。如果你手上的專案不需要支援這些老舊的瀏覽器，恭喜你，這種機遇不是人人都有！如果你跟本人同樣不幸，只能為了需求妥協，這邊推薦幾個好物參考用，希望能節省各位的加班費。</p><h3 id=compatible-tables>Compatible tables<a hidden class=anchor aria-hidden=true href=#compatible-tables>#</a></h3><p>有時候不知道某個 feature 在各平台上支援程度如何，一般我們會看兩個網站：</p><ul><li><a href=https://caniuse.com/>Can I use&mldr; Support tables for HTML5, CSS3, etc</a></li><li><a href=https://kangax.github.io/compat-table/es6/>ECMAScript 6 compatibility table</a></li></ul><p>前者專注在 Browser support 的 Web API，許多 CSS 或 DOM 的 feature 都有詳細的資訊，不過有時關鍵字搜尋不易找到。當然還有<a href="https://www.google.com.tw/search?q=caniuse+plugin">各種 Plugin</a> 或 <a href=https://github.com/sgentle/caniuse-cmd>commandline tool</a> 可以安裝。</p><p>後者就比較陽春一點，沒有實用的搜尋功能，但一些 JavaScript 基礎語法就要靠它了解支援程度。例如 Array 的各種 fuctional methods，我從來都不記得哪個在哪裡有實作。（不過 Babel／TypeScript 大火，還有人在管 JS 相容性嗎 XD）</p><h3 id=cross-browser-testing-services>Cross browser testing services<a hidden class=anchor aria-hidden=true href=#cross-browser-testing-services>#</a></h3><p>跨瀏覽器測試是前端工程最為複雜惱人的部分之一，各家瀏覽器在每個平台上都有不同的表現，一般企業很難有齊全的測試環境，所以就有許多 <strong>cross browser testing services</strong> 興起，比較有名的幾家如：</p><ul><li><a href=https://saucelabs.com/>SauceLabs</a></li><li><a href=https://www.browserstack.com>BrowserStack</a></li></ul><p>透過這些跨平台測試工具，可以全面檢測自家的 codebase，減少建置 infrastructure 的負擔，加上他們都有豐富的 API 與文件，整合 CI／CD 更為方便，價格有不會太貴，個人認為開發前端的公司考慮一下。</p><blockquote><p>因為 Mozilla 與 Microsoft 有跟 BrowserStack 合作，目前測試 Edge、Firefox 都完全免費，所以本人就像牆頭草一樣選擇 BrowserStack 了。</p></blockquote><h3 id=virtual-machines>Virtual machines<a hidden class=anchor aria-hidden=true href=#virtual-machines>#</a></h3><p>如果買不起上面的 testing services，這邊有個省錢（但很累人）的方法，就是使用 <strong>VirtualBox</strong> + <strong>Windows 10 Insider Preview</strong> 測試 Edge 和 IE，Insider Preview 只要註冊就可以用了！</p><p>因為怕被黑，細節就不多講，還是建議大家直接使用正版，或是買別人的測試服務吧。</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>俗諺有云：「IE 是前端工程的墳墓」，與 IE 交往，切勿急躁，想清楚，多溝通，有時候她鬧點彆扭就讓著吧，不要疾病亂投 polyfill，破壞<del>你與 IE 之間的愛</del>架構絕對更痛苦。</p><p>往後若有其他 IE 相容性的 Issue，本文會再繼續更新。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://weihanglo.tw/tags/internet-explorer/>Internet Explorer</a></li><li><a href=https://weihanglo.tw/tags/front-end/>Front-End</a></li><li><a href=https://weihanglo.tw/tags/javascript/>JavaScript</a></li><li><a href=https://weihanglo.tw/tags/web-compatibility/>Web Compatibility</a></li><li><a href=https://weihanglo.tw/tags/browser-testing/>Browser Testing</a></li></ul><nav class=paginav><a class=prev href=https://weihanglo.tw/posts/2017/answers-to-cherny-interview-questions/><span class=title>« Prev</span><br><span>試答 Cherny 所謂「最好的前端面試題」</span>
</a><a class=next href=https://weihanglo.tw/posts/2017/javascript-concurrency-async-function/><span class=title>Next »</span><br><span>現代化的 JavaScript 併發 - Async Functions</span></a></nav></footer></article></main><footer class=footer><span>CC BY-NC-SA 4.0</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>