<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="organizations which design systems are constrained to produce designs which are copies of the communication structures of these organizations.
&ndash; M. Conway
 這裡是 WWW 第捌期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。
My FOSS Story 這篇文章是 Rust 社群非常有名的 Andrew Gallant (@burntsushi) 所撰，講述了他自身與 FOSS 的糾葛。文章裡面許多篇幅在描述 FOSS 中的負面事情，不過這也是開源社群較少提及和處理的一塊。這篇文章也可以視為是 burntsushi 針對最近 Rust 社群最大的 web framework Actix 的作者退出開源界的有感而發。節錄一些我覺得可以帶著走的實用想法：
 設立界線：開源即政治，網路上就是有一堆酸民，就算沒有，也有太多太多 issue 和 PR 壓得我們喘不過氣，把開源工作和個人生活切割開來，設立界線和停損點，自己的活自己安排。 遵循「比例原則」：如果提出一個問題卻僅寥寥幾行，就用寥寥幾行回覆吧。 問題重現：良好的問題回報能搭配簡單重現方式最棒，如果沒辦法，那就帶著作者一起 debug 吧！  作者最後雖然表列許多負面行為，但也說了 FOSS 仍然有許多有趣的經驗和美好。信任為開源之本，希望這篇文章能帶給 FOSS 界打滾的我們更多啟發。
Uncharted territory – discovering vulnerabilities in public Helm Charts ⚠️⚠️⚠️ 你的 Helm chart 安全嗎 ⚠️⚠️⚠️"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="WWW 0x08: 你的 Helm chart 安全嗎 • Weihang Lo"><meta property="og:description" content="organizations which design systems are constrained to produce designs which are copies of the communication structures of these organizations.
&ndash; M. Conway
 這裡是 WWW 第捌期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。
My FOSS Story 這篇文章是 Rust 社群非常有名的 Andrew Gallant (@burntsushi) 所撰，講述了他自身與 FOSS 的糾葛。文章裡面許多篇幅在描述 FOSS 中的負面事情，不過這也是開源社群較少提及和處理的一塊。這篇文章也可以視為是 burntsushi 針對最近 Rust 社群最大的 web framework Actix 的作者退出開源界的有感而發。節錄一些我覺得可以帶著走的實用想法：
 設立界線：開源即政治，網路上就是有一堆酸民，就算沒有，也有太多太多 issue 和 PR 壓得我們喘不過氣，把開源工作和個人生活切割開來，設立界線和停損點，自己的活自己安排。 遵循「比例原則」：如果提出一個問題卻僅寥寥幾行，就用寥寥幾行回覆吧。 問題重現：良好的問題回報能搭配簡單重現方式最棒，如果沒辦法，那就帶著作者一起 debug 吧！  作者最後雖然表列許多負面行為，但也說了 FOSS 仍然有許多有趣的經驗和美好。信任為開源之本，希望這篇文章能帶給 FOSS 界打滾的我們更多啟發。
Uncharted territory – discovering vulnerabilities in public Helm Charts ⚠️⚠️⚠️ 你的 Helm chart 安全嗎 ⚠️⚠️⚠️"><meta property="og:url" content="https://weihanglo.tw/posts/2020/www-0x08/"><meta property="og:site_name" content="Weihang Lo"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="Weekly"><meta property="article:tag" content="FOSS"><meta property="article:tag" content="Kubernetes"><meta property="article:published_time" content="2020-03-14T00:00:00+08:00"><meta property="article:modified_time" content="2020-03-14T00:00:00+08:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>WWW 0x08: 你的 Helm chart 安全嗎 • Weihang Lo</title><link rel=canonical href=https://weihanglo.tw/posts/2020/www-0x08/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><link rel=stylesheet href=/css/custom.css><style>:root{--color-accent:#ffcd00}</style></head><body class="page type-posts"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/posts/>Posts</a></li><li class=item><a href=/tags/>Tags</a></li><li class=item><a href=/about/>About</a></li></ul></div></nav><div class=header-widgets><div class=container></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Weihang Lo</p><p class="desc site-desc"></p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>WWW 0x08: 你的 Helm chart 安全嗎</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2020-03-14T00:00:00+08:00>2020, Mar 14</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>2 mins read</span></div></div></header><div class="container entry-content"><blockquote><p>organizations which design systems are constrained to produce designs which are copies of the communication structures of these organizations.</p><p>&ndash; M. Conway</p></blockquote><p>這裡是 WWW 第捌期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。</p><h2 id=my-foss-storyhttpsblogburntsushinetfossother-thoughts-on-entitlement><a href=https://blog.burntsushi.net/foss/#other-thoughts-on-entitlement>My FOSS Story</a></h2><p>這篇文章是 Rust 社群非常有名的 Andrew Gallant (<a href=https://github.com/burntsushi>@burntsushi</a>) 所撰，講述了他自身與 FOSS 的糾葛。文章裡面許多篇幅在描述 FOSS 中的負面事情，不過這也是開源社群較少提及和處理的一塊。這篇文章也可以視為是 burntsushi 針對最近 Rust 社群最大的 web framework <a href=https://github.com/actix/actix-web/issues/1289>Actix 的作者退出開源界</a>的有感而發。節錄一些我覺得可以帶著走的實用想法：</p><ul><li>設立界線：開源即政治，網路上就是有一堆酸民，就算沒有，也有太多太多 issue 和 PR 壓得我們喘不過氣，把開源工作和個人生活切割開來，設立界線和停損點，自己的活自己安排。</li><li>遵循「比例原則」：如果提出一個問題卻僅寥寥幾行，就用寥寥幾行回覆吧。</li><li>問題重現：良好的問題回報能搭配簡單重現方式最棒，如果沒辦法，那就帶著作者一起 debug 吧！</li></ul><p>作者最後雖然表列許多負面行為，但也說了 FOSS 仍然有許多有趣的經驗和美好。信任為開源之本，希望這篇文章能帶給 FOSS 界打滾的我們更多啟發。</p><h2 id=uncharted-territory--discovering-vulnerabilities-in-public-helm-chartshttpssnykiobloguncharted-territory-discovering-vulnerabilities-in-public-helm-charts><a href=https://snyk.io/blog/uncharted-territory-discovering-vulnerabilities-in-public-helm-charts/>Uncharted territory – discovering vulnerabilities in public Helm Charts</a></h2><p><strong>⚠️⚠️⚠️ 你的 Helm chart 安全嗎 ⚠️⚠️⚠️</strong></p><p>專門做各大語言的開源套件安全性檢驗的 <a href=https://snyk.io>Snyk</a>，除了檢驗原有的 npm、PyPI 等套件，最近開始檢驗起 Helm 官方的 stable charts 中每個 image 是否有安全性漏洞，並出一份<a href=https://snyk.io/wp-content/uploads/helm-report.pdf>安全性報告</a>。報告指出：</p><ul><li>277 個 stable chart 中，68% 有高度安全性漏洞，但 64% 可以透過升級 image 來解決漏洞</li><li>最常見的風險有：out-of-bounds reads/writes、access restriction bypass、NULL pointer dereference（一和三 Rust 完美解決）</li><li><a href=https://hub.docker.com/r/dduportal/bats><code>dduportal/bats:0.4.0</code></a> 是最常用的 image，也擁有最多漏洞。<code>postgres:9.6.2</code> 第二。<code>unguiculus/docker-python3-phantomjs-selenium:v1</code> 第三。</li></ul><p>此外，Snyk 同時開源了<a href=https://github.com/snyk-labs/helm-snyk>一支方便檢查 Helm chart image 安全性的 Helm plugin</a>，非常方便，<del>除了需要註冊 Snyk 帳號順便竊取電子郵件之外</del>。</p><h2 id=architecting-kubernetes-clusters--how-many-should-you-havehttpslearnk8siohow-many-clusters><a href=https://learnk8s.io/how-many-clusters>Architecting Kubernetes clusters — how many should you have?</a></h2><p><img src=https://learnk8s.io/a/6f3a82b403f001b6862a27ee3e41879b.svg alt></p><p>本篇文章說明不同數量的 cluster 規劃之應用場景與優劣勢，文內附有許多連結，值得延伸閱讀。</p><ul><li><a href=https://learnk8s.io/how-many-clusters#1-one-large-shared-cluster>單一大型共用 cluster</a>：所有不同環境的 app 都在同一個 cluster<ul><li>✅ 資源利用率高</li><li>✅ 便宜</li><li>✅ 管理容易：CI/CD 流程、升級 k8s</li><li>👎 單點故障機率高：k8s 升級失敗、clsuter-wide 元件壞掉</li><li>👎 安全性較差：物理隔離程度低，可以透過 <a href=https://kubernetes.io/docs/concepts/policy/pod-security-policy/>PodSecurityPolicy</a> 處理，但並非易事</li><li>👎 無物理資源隔離：資源隔離只能透過 <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/>resource request limit</a>、<a href=https://kubernetes.io/docs/concepts/policy/resource-quotas/>ResourceQuota</a> 處理，同樣不好設定</li><li>👎 多使用者：較不安全，須通過 <a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/>RBAC</a> 額外設定</li><li>👎 Cluster 不能無限制增長：node 和 pod 還有 container 在 cluster 中都有一個理論上限值，需注意。</li></ul></li><li><a href=https://learnk8s.io/how-many-clusters#2-many-small-single-use-clusters>多個小型單一用途 cluster</a>：不同環境，不同 app 都各自獨立一個 cluster<ul><li>✅ 縮小爆破半徑：一個 cluster 掛了就是一個特定環境的 app 掛了而已</li><li>✅ 獨立隔離：每個工作負載（workload）都是獨立的環境、OS、CPU、memory</li><li>✅ 較少使用者：更容易管理 cluster 的 access control</li><li>👎 資源利用率低</li><li>👎 比較貴：data plane 和 control plane 都增加了</li><li>👎 複雜的跨 cluster 權限管理</li></ul></li><li><a href=https://learnk8s.io/how-many-clusters#3-cluster-per-application>一個 app 一個 cluster</a>：每個 app 的不同環境（開發、正式、測試）都放在同一個 cluster<ul><li>✅ cluster 可以為 app 量身打造（e.g. MongodDB 就可以用 zfs 的 node）</li><li>👎 不同環境在同一個 cluster：測試或開發環境如果有 bug，可能會導致正式環境崩壞</li></ul></li><li><a href=https://learnk8s.io/how-many-clusters#4-cluster-per-environment>一個環境一個 cluster</a>：按照測試、開發、正式等環境建立不同的 cluster<ul><li>✅ 隔離「正式」環境（不必解釋）</li><li>✅ 最小化正式環境的 access control：除了 CI/CD，原則上沒有人需要進入正式環境</li><li>👎 APP 之間沒有隔離</li><li>👎 環境沒有針對不同需求最佳化：例如有需要 GPU 的 app，那就每個環境都需要裝一個 GPU node</li></ul></li></ul><p>我個人看完的結論是</p><ol><li>先學好各種 resource request limit 和 RBAC</li><li>把 service mesh、service discovery、API gateway 這些基礎設施搞好，讓 inter-cluster 溝通無障礙</li><li>從 Cluster per environment 開始搞起，有需求再特化出 app-specific cluster</li><li>永遠記得 <a href=https://en.wikipedia.org/wiki/Conway%27s_law>Conway&rsquo;s law</a></li></ol></div><footer class=entry-footer><div class="container sep-before"><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/weekly/>Weekly</a>, <a class=tag href=/tags/foss/>FOSS</a>, <a class=tag href=/tags/kubernetes/>Kubernetes</a></div></div><div style=text-align:center;padding-top:2em><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/><img src=https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png alt=cc-by-nc-sa-4></a></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before"><a href=/posts/2020/www-0x07/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>WWW 0x07: 為什麼薯餅要炸兩次</a></div><div class="next-entry sep-before"><a href=/posts/2020/www-0x09/><span class=screen-reader-text>Next post: </span>WWW 0x09: 到底要不要擔心 blocking<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://facebook.com/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Facebook account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></a></li><li><a href=https://twitter.com/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=https://linkedin.com/in/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li><li><a href=https://t.me/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Telegram account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Telegram icon</title><path d="M23.91 3.79 20.3 20.84c-.25 1.21-.98 1.5-2 .94l-5.5-4.07-2.66 2.57c-.3.3-.55.56-1.1.56-.72.0-.6-.27-.84-.95L6.3 13.7l-5.45-1.7c-1.18-.35-1.19-1.16.26-1.75l21.26-8.2c.97-.43 1.9.24 1.53 1.73z"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2017-2021 Weihang Lo</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script src=/js/custom.js></script></body></html>