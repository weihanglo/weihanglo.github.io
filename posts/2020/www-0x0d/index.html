<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="欸，工時系統禁止報加班！？
— Weihang Lo 2020.4
 這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。
The Facts: Mozilla’s DNS over HTTPs (DoH) 西元二零二零年二月二十五日起，Firefox 預設開啟了 DNS over HTTPS（DoH）的功能，這會導致：
 原本裸奔的 DNS query 可以透過 HTTPS 加密，不會再被看光光 DNS 隱私資料從被 ISP 幹走變成被 Cloudflare/NextDNS 或其他 DoH 供應商幹走 因為不會走你家的 internal DNS service，有些解析會壞掉 👋 你不會再看見色情守門員  DoH 算是一個容易起爭議的功能，例如：
 Firefox DoH 預設是 Cloudflare 讓 OpenBSD 的 Firefox 版預設直接關閉 DoH Chrome 的行為則是如果 DNS provider 有支援 DoH 才自動開啟，爭議點在很多人都用 8.8.8.8 那還不是一定會走 Google 的 DoH 英國 ISP 商們票選 Mozilla 為 2019 年度網路惡棍，因為「DoH 阻撓網路監管，網路會成犯罪溫床」，帥 DoH 造成 DNS server 從集中在 ISP 變成集中在大型 DoH 網路公司  還是可以理解一下為什麼 Firefox 要預設 DoH，至於是否開啟就看個人囉。"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="WWW 0x0D: 已達上限 • Weihang Lo"><meta property="og:description" content="欸，工時系統禁止報加班！？
— Weihang Lo 2020.4
 這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。
The Facts: Mozilla’s DNS over HTTPs (DoH) 西元二零二零年二月二十五日起，Firefox 預設開啟了 DNS over HTTPS（DoH）的功能，這會導致：
 原本裸奔的 DNS query 可以透過 HTTPS 加密，不會再被看光光 DNS 隱私資料從被 ISP 幹走變成被 Cloudflare/NextDNS 或其他 DoH 供應商幹走 因為不會走你家的 internal DNS service，有些解析會壞掉 👋 你不會再看見色情守門員  DoH 算是一個容易起爭議的功能，例如：
 Firefox DoH 預設是 Cloudflare 讓 OpenBSD 的 Firefox 版預設直接關閉 DoH Chrome 的行為則是如果 DNS provider 有支援 DoH 才自動開啟，爭議點在很多人都用 8.8.8.8 那還不是一定會走 Google 的 DoH 英國 ISP 商們票選 Mozilla 為 2019 年度網路惡棍，因為「DoH 阻撓網路監管，網路會成犯罪溫床」，帥 DoH 造成 DNS server 從集中在 ISP 變成集中在大型 DoH 網路公司  還是可以理解一下為什麼 Firefox 要預設 DoH，至於是否開啟就看個人囉。"><meta property="og:url" content="https://weihanglo.tw/posts/2020/www-0x0d/"><meta property="og:site_name" content="Weihang Lo"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="Cryptography"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Privacy"><meta property="article:published_time" content="2020-04-18T00:00:00+08:00"><meta property="article:modified_time" content="2020-04-18T00:00:00+08:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>WWW 0x0D: 已達上限 • Weihang Lo</title><link rel=canonical href=https://weihanglo.tw/posts/2020/www-0x0d/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><link rel=stylesheet href=/css/custom.css><style>:root{--color-accent:#ffcd00}</style></head><body class="page type-posts"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/posts/>Posts</a></li><li class=item><a href=/tags/>Tags</a></li><li class=item><a href=/about/>About</a></li></ul></div></nav><div class=header-widgets><div class=container></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Weihang Lo</p><p class="desc site-desc"></p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>WWW 0x0D: 已達上限</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2020-04-18T00:00:00+08:00>2020, Apr 18</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>One min read</span></div></div></header><div class="container entry-content"><blockquote><p>欸，工時系統禁止報加班！？</p><p>— Weihang Lo 2020.4</p></blockquote><p>這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。</p><h2 id=the-facts-mozillas-dns-over-https-dohhttpsblogmozillaorgnetpolicy20200225the-facts-mozillas-dns-over-https-doh><a href=https://blog.mozilla.org/netpolicy/2020/02/25/the-facts-mozillas-dns-over-https-doh/>The Facts: Mozilla’s DNS over HTTPs (DoH)</a></h2><p><img src=https://i.imgur.com/LgNKRtn.png alt></p><p>西元二零二零年二月二十五日起，Firefox 預設開啟了 DNS over HTTPS（DoH）的功能，這會導致：</p><ul><li>原本裸奔的 DNS query 可以透過 HTTPS 加密，不會再被看光光</li><li>DNS 隱私資料從被 ISP 幹走變成被 Cloudflare/NextDNS 或其他 DoH 供應商幹走</li><li>因為不會走你家的 internal DNS service，有些解析會壞掉 👋</li><li>你不會再看見色情守門員</li></ul><p>DoH 算是一個容易起爭議的功能，例如：</p><ul><li>Firefox DoH 預設是 Cloudflare 讓 OpenBSD 的 Firefox 版預設直接關閉 DoH</li><li>Chrome 的行為則是如果 DNS provider 有支援 DoH 才自動開啟，爭議點在很多人都用 8.8.8.8 那還不是一定會走 Google 的 DoH</li><li>英國 ISP 商們票選 Mozilla 為 <a href=https://www.ispa.org.uk/ispa-announces-finalists-for-2019-internet-heroes-and-villains-trump-and-mozilla-lead-the-way-as-villain-nominees/>2019 年度網路惡棍</a>，因為「DoH 阻撓網路監管，網路會成犯罪溫床」，帥</li><li>DoH 造成 DNS server 從集中在 ISP 變成集中在大型 DoH 網路公司</li></ul><p>還是可以理解一下為什麼 Firefox 要預設 DoH，至於是否開啟就看個人囉。</p><h2 id=no-more-crypto-fails-現代密碼學入門httpsspeakerdeckcominndyno-more-crypto-fails><a href=https://speakerdeck.com/inndy/no-more-crypto-fails>No More Crypto Fails 現代密碼學入門</a></h2><p>非常簡明的密碼學入門，沒有提到太多數學理論，花個十五分鐘閱讀，然後再花十五分鐘 google，搞懂不熟的知識點吧！</p><blockquote><p>順便推薦個 Stanford 大學 Dan Boneh 的<a href=https://www.coursera.org/learn/crypto>密碼學課程</a></p></blockquote><h2 id=dns-lookups-in-kuberneteshttpsmrkarandevpostsndots-kubernetes><a href=https://mrkaran.dev/posts/ndots-kubernetes/>DNS Lookups in Kubernetes</a></h2><p>你以為 Kubernetes 的 DNS 解析只是 $service.$namespace.svc.cluster.local 嗎？其實 pod 的 DNS 解析一樣會看 <a href=http://man7.org/linux/man-pages/man5/resolv.conf.5.html><code>/etc/resolv.conf</code></a> 檔案，而且會做以下設定：</p><ul><li><code>nameserver</code>：指向 CoreDNS 服務 IP</li><li><code>search</code>：欲解析的 domain 不是 FQDN 時，這個 search list 的 domain 會被當作 root domain，K8s 預設會加入 <code>$namespace.svc.$zone</code>、<code>svc.$zone</code>、<code>$zone</code> 三個 domain</li><li><code>options ndots:5</code>：表示只有 domain 有超過五個 <code>.</code> 時，才會被當作 FQDN，否則則是 prepend 到 <code>search</code> list 的 root domain來搜尋</li></ul><p>綜合上述，如果我的服務叫做 <code>my-service</code>，DNS resolution 的順序可能會是：</p><ol><li>ndots &lt; 5，不是 FQDN，不當作 FQDN 解析，嘗試 prepend 到 search list</li><li>我的 namespace 叫 <code>my-ns</code>，則嘗試解析 <code>my-service.my-ns.svc.cluster.local.</code></li><li>若解析失敗，則嘗試解析 <code>my-service.svc.cluster.local.</code></li><li>若解析失敗，則嘗試解析 <code>my-service.cluster.local.</code></li><li>最後才會把 <code>my-service.</code> 當作 FQDN 來解析</li></ol><p>Kubernetes 官方也有對這個 <a href=https://github.com/kubernetes/kubernetes/issues/33554#issuecomment-266251056><code>ndots:5</code> 的設計做出解釋</a>（但現在換成 CoreDNS 了？），是為了要同時支援解析 same-namespace、cross-namespace 還有 SRV record（<code>_$port._$proto</code> 的格式，講到這個就想到 external-dns 一直不 review 我的 SRV 相關 PR 🤯）。雖然有人說 <a href=https://pracucci.com/kubernetes-dns-resolution-ndots-options-and-why-it-may-affect-application-performances.html><code>ndots:5</code> 有效能隱憂</a>，但 DNS 照理說應該會被 cache 起來？總之，如果不是需要 low latency 的服務，使用 Kubernetes 預設值應該不會錯。</p></div><footer class=entry-footer><div class="container sep-before"><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/cryptography/>Cryptography</a>, <a class=tag href=/tags/kubernetes/>Kubernetes</a>, <a class=tag href=/tags/privacy/>Privacy</a></div></div><div style=text-align:center;padding-top:2em><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/><img src=https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png alt=cc-by-nc-sa-4></a></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before"><a href=/posts/2020/www-0x0c/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>WWW 0x0C: 未具名</a></div><div class="next-entry sep-before"><a href=/posts/2020/www-0x0e/><span class=screen-reader-text>Next post: </span>WWW 0x0E: 親愛的，我把快取都放你腦中了<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://facebook.com/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Facebook account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></a></li><li><a href=https://twitter.com/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=https://linkedin.com/in/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li><li><a href=https://t.me/weihanglo target=_blank rel=noopener><span class=screen-reader-text>Open Telegram account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Telegram icon</title><path d="M23.91 3.79 20.3 20.84c-.25 1.21-.98 1.5-2 .94l-5.5-4.07-2.66 2.57c-.3.3-.55.56-1.1.56-.72.0-.6-.27-.84-.95L6.3 13.7l-5.45-1.7c-1.18-.35-1.19-1.16.26-1.75l21.26-8.2c.97-.43 1.9.24 1.53 1.73z"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2017-2021 Weihang Lo</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script src=/js/custom.js></script></body></html>