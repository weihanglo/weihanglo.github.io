<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>WWW 0x0D: 已達上限 | Life is a refactoring process without tests</title>
<meta name=keywords content="Cryptography,Kubernetes,Privacy">
<meta name=description content="欸，工時系統禁止報加班！？ — Weihang Lo 2020.4 這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟">
<meta name=author content>
<link rel=canonical href=https://weihanglo.tw/posts/2020/www-0x0d/>
<link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style>
<link rel=icon href=https://weihanglo.tw/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://weihanglo.tw/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://weihanglo.tw/favicon-32x32.png>
<link rel=apple-touch-icon href=https://weihanglo.tw/apple-touch-icon.png>
<link rel=mask-icon href=https://weihanglo.tw/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:!0},{left:'$',right:'$',display:!1},{left:'\\(',right:'\\)',display:!1},{left:'\\[',right:'\\]',display:!0}],throwOnError:!1})})</script>
<meta property="og:title" content="WWW 0x0D: 已達上限">
<meta property="og:description" content="欸，工時系統禁止報加班！？ — Weihang Lo 2020.4 這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟">
<meta property="og:type" content="article">
<meta property="og:url" content="https://weihanglo.tw/posts/2020/www-0x0d/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-04-18T00:00:00+08:00">
<meta property="article:modified_time" content="2020-04-18T00:00:00+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="WWW 0x0D: 已達上限">
<meta name=twitter:description content="欸，工時系統禁止報加班！？ — Weihang Lo 2020.4 這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://weihanglo.tw/posts/"},{"@type":"ListItem","position":3,"name":"WWW 0x0D: 已達上限","item":"https://weihanglo.tw/posts/2020/www-0x0d/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"WWW 0x0D: 已達上限","name":"WWW 0x0D: 已達上限","description":"欸，工時系統禁止報加班！？ — Weihang Lo 2020.4 這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟","keywords":["Cryptography","Kubernetes","Privacy"],"articleBody":" 欸，工時系統禁止報加班！？\n— Weihang Lo 2020.4\n 這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。\nThe Facts: Mozilla’s DNS over HTTPs (DoH) 西元二零二零年二月二十五日起，Firefox 預設開啟了 DNS over HTTPS（DoH）的功能，這會導致：\n 原本裸奔的 DNS query 可以透過 HTTPS 加密，不會再被看光光 DNS 隱私資料從被 ISP 幹走變成被 Cloudflare/NextDNS 或其他 DoH 供應商幹走 因為不會走你家的 internal DNS service，有些解析會壞掉 👋 你不會再看見色情守門員  DoH 算是一個容易起爭議的功能，例如：\n Firefox DoH 預設是 Cloudflare 讓 OpenBSD 的 Firefox 版預設直接關閉 DoH Chrome 的行為則是如果 DNS provider 有支援 DoH 才自動開啟，爭議點在很多人都用 8.8.8.8 那還不是一定會走 Google 的 DoH 英國 ISP 商們票選 Mozilla 為 2019 年度網路惡棍，因為「DoH 阻撓網路監管，網路會成犯罪溫床」，帥 DoH 造成 DNS server 從集中在 ISP 變成集中在大型 DoH 網路公司  還是可以理解一下為什麼 Firefox 要預設 DoH，至於是否開啟就看個人囉。\nNo More Crypto Fails 現代密碼學入門 非常簡明的密碼學入門，沒有提到太多數學理論，花個十五分鐘閱讀，然後再花十五分鐘 google，搞懂不熟的知識點吧！\n 順便推薦個 Stanford 大學 Dan Boneh 的密碼學課程\n DNS Lookups in Kubernetes 你以為 Kubernetes 的 DNS 解析只是 $service.$namespace.svc.cluster.local 嗎？其實 pod 的 DNS 解析一樣會看 /etc/resolv.conf 檔案，而且會做以下設定：\n nameserver：指向 CoreDNS 服務 IP search：欲解析的 domain 不是 FQDN 時，這個 search list 的 domain 會被當作 root domain，K8s 預設會加入 $namespace.svc.$zone、svc.$zone、$zone 三個 domain options ndots:5：表示只有 domain 有超過五個 . 時，才會被當作 FQDN，否則則是 prepend 到 search list 的 root domain來搜尋  綜合上述，如果我的服務叫做 my-service，DNS resolution 的順序可能會是：\n ndots 我的 namespace 叫 my-ns，則嘗試解析 my-service.my-ns.svc.cluster.local. 若解析失敗，則嘗試解析 my-service.svc.cluster.local. 若解析失敗，則嘗試解析 my-service.cluster.local. 最後才會把 my-service. 當作 FQDN 來解析  Kubernetes 官方也有對這個 ndots:5 的設計做出解釋（但現在換成 CoreDNS 了？），是為了要同時支援解析 same-namespace、cross-namespace 還有 SRV record（_$port._$proto 的格式，講到這個就想到 external-dns 一直不 review 我的 SRV 相關 PR 🤯）。雖然有人說 ndots:5 有效能隱憂，但 DNS 照理說應該會被 cache 起來？總之，如果不是需要 low latency 的服務，使用 Kubernetes 預設值應該不會錯。\n","wordCount":"960","inLanguage":"en","datePublished":"2020-04-18T00:00:00+08:00","dateModified":"2020-04-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://weihanglo.tw/posts/2020/www-0x0d/"},"publisher":{"@type":"Organization","name":"Life is a refactoring process without tests","logo":{"@type":"ImageObject","url":"https://weihanglo.tw/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://weihanglo.tw accesskey=h title="Life is a refactoring process without tests (Alt + H)">Life is a refactoring process without tests</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://weihanglo.tw/ title=Home>
<span>Home</span>
</a>
</li>
<li>
<a href=https://weihanglo.tw/archives/ title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://weihanglo.tw/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://weihanglo.tw/about/ title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
WWW 0x0D: 已達上限
</h1>
<div class=post-meta><span title="2020-04-18 00:00:00 +0800 +0800">April 18, 2020</span>&nbsp;·&nbsp;2 min
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#the-facts-mozillas-dns-over-https-dohhttpsblogmozillaorgnetpolicy20200225the-facts-mozillas-dns-over-https-doh aria-label="The Facts: Mozilla’s DNS over HTTPs (DoH)"><a href=https://blog.mozilla.org/netpolicy/2020/02/25/the-facts-mozillas-dns-over-https-doh/>The Facts: Mozilla’s DNS over HTTPs (DoH)</a></a></li>
<li>
<a href=#no-more-crypto-fails-%e7%8f%be%e4%bb%a3%e5%af%86%e7%a2%bc%e5%ad%b8%e5%85%a5%e9%96%80httpsspeakerdeckcominndyno-more-crypto-fails aria-label="No More Crypto Fails 現代密碼學入門"><a href=https://speakerdeck.com/inndy/no-more-crypto-fails>No More Crypto Fails 現代密碼學入門</a></a></li>
<li>
<a href=#dns-lookups-in-kuberneteshttpsmrkarandevpostsndots-kubernetes aria-label="DNS Lookups in Kubernetes"><a href=https://mrkaran.dev/posts/ndots-kubernetes/>DNS Lookups in Kubernetes</a></a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><blockquote>
<p>欸，工時系統禁止報加班！？</p>
<p>— Weihang Lo 2020.4</p>
</blockquote>
<p>這裡是 WWW 第拾參期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。</p>
<h2 id=the-facts-mozillas-dns-over-https-dohhttpsblogmozillaorgnetpolicy20200225the-facts-mozillas-dns-over-https-doh><a href=https://blog.mozilla.org/netpolicy/2020/02/25/the-facts-mozillas-dns-over-https-doh/>The Facts: Mozilla’s DNS over HTTPs (DoH)</a><a hidden class=anchor aria-hidden=true href=#the-facts-mozillas-dns-over-https-dohhttpsblogmozillaorgnetpolicy20200225the-facts-mozillas-dns-over-https-doh>#</a></h2>
<p><img loading=lazy src=https://i.imgur.com/LgNKRtn.png alt>
</p>
<p>西元二零二零年二月二十五日起，Firefox 預設開啟了 DNS over HTTPS（DoH）的功能，這會導致：</p>
<ul>
<li>原本裸奔的 DNS query 可以透過 HTTPS 加密，不會再被看光光</li>
<li>DNS 隱私資料從被 ISP 幹走變成被 Cloudflare/NextDNS 或其他 DoH 供應商幹走</li>
<li>因為不會走你家的 internal DNS service，有些解析會壞掉 👋</li>
<li>你不會再看見色情守門員</li>
</ul>
<p>DoH 算是一個容易起爭議的功能，例如：</p>
<ul>
<li>Firefox DoH 預設是 Cloudflare 讓 OpenBSD 的 Firefox 版預設直接關閉 DoH</li>
<li>Chrome 的行為則是如果 DNS provider 有支援 DoH 才自動開啟，爭議點在很多人都用 8.8.8.8 那還不是一定會走 Google 的 DoH</li>
<li>英國 ISP 商們票選 Mozilla 為 <a href=https://www.ispa.org.uk/ispa-announces-finalists-for-2019-internet-heroes-and-villains-trump-and-mozilla-lead-the-way-as-villain-nominees/>2019 年度網路惡棍</a>，因為「DoH 阻撓網路監管，網路會成犯罪溫床」，帥</li>
<li>DoH 造成 DNS server 從集中在 ISP 變成集中在大型 DoH 網路公司</li>
</ul>
<p>還是可以理解一下為什麼 Firefox 要預設 DoH，至於是否開啟就看個人囉。</p>
<h2 id=no-more-crypto-fails-現代密碼學入門httpsspeakerdeckcominndyno-more-crypto-fails><a href=https://speakerdeck.com/inndy/no-more-crypto-fails>No More Crypto Fails 現代密碼學入門</a><a hidden class=anchor aria-hidden=true href=#no-more-crypto-fails-現代密碼學入門httpsspeakerdeckcominndyno-more-crypto-fails>#</a></h2>
<p>非常簡明的密碼學入門，沒有提到太多數學理論，花個十五分鐘閱讀，然後再花十五分鐘 google，搞懂不熟的知識點吧！</p>
<blockquote>
<p>順便推薦個 Stanford 大學 Dan Boneh 的<a href=https://www.coursera.org/learn/crypto>密碼學課程</a></p>
</blockquote>
<h2 id=dns-lookups-in-kuberneteshttpsmrkarandevpostsndots-kubernetes><a href=https://mrkaran.dev/posts/ndots-kubernetes/>DNS Lookups in Kubernetes</a><a hidden class=anchor aria-hidden=true href=#dns-lookups-in-kuberneteshttpsmrkarandevpostsndots-kubernetes>#</a></h2>
<p>你以為 Kubernetes 的 DNS 解析只是 $service.$namespace.svc.cluster.local 嗎？其實 pod 的 DNS 解析一樣會看 <a href=http://man7.org/linux/man-pages/man5/resolv.conf.5.html><code>/etc/resolv.conf</code></a> 檔案，而且會做以下設定：</p>
<ul>
<li><code>nameserver</code>：指向 CoreDNS 服務 IP</li>
<li><code>search</code>：欲解析的 domain 不是 FQDN 時，這個 search list 的 domain 會被當作 root domain，K8s 預設會加入 <code>$namespace.svc.$zone</code>、<code>svc.$zone</code>、<code>$zone</code> 三個 domain</li>
<li><code>options ndots:5</code>：表示只有 domain 有超過五個 <code>.</code> 時，才會被當作 FQDN，否則則是 prepend 到 <code>search</code> list 的 root domain來搜尋</li>
</ul>
<p>綜合上述，如果我的服務叫做 <code>my-service</code>，DNS resolution 的順序可能會是：</p>
<ol>
<li>ndots &lt; 5，不是 FQDN，不當作 FQDN 解析，嘗試 prepend 到 search list</li>
<li>我的 namespace 叫 <code>my-ns</code>，則嘗試解析 <code>my-service.my-ns.svc.cluster.local.</code></li>
<li>若解析失敗，則嘗試解析 <code>my-service.svc.cluster.local.</code></li>
<li>若解析失敗，則嘗試解析 <code>my-service.cluster.local.</code></li>
<li>最後才會把 <code>my-service.</code> 當作 FQDN 來解析</li>
</ol>
<p>Kubernetes 官方也有對這個 <a href=https://github.com/kubernetes/kubernetes/issues/33554#issuecomment-266251056><code>ndots:5</code> 的設計做出解釋</a>（但現在換成 CoreDNS 了？），是為了要同時支援解析 same-namespace、cross-namespace 還有 SRV record（<code>_$port._$proto</code> 的格式，講到這個就想到 external-dns 一直不 review 我的 SRV 相關 PR 🤯）。雖然有人說 <a href=https://pracucci.com/kubernetes-dns-resolution-ndots-options-and-why-it-may-affect-application-performances.html><code>ndots:5</code> 有效能隱憂</a>，但 DNS 照理說應該會被 cache 起來？總之，如果不是需要 low latency 的服務，使用 Kubernetes 預設值應該不會錯。</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://weihanglo.tw/tags/cryptography/>Cryptography</a></li>
<li><a href=https://weihanglo.tw/tags/kubernetes/>Kubernetes</a></li>
<li><a href=https://weihanglo.tw/tags/privacy/>Privacy</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://weihanglo.tw/posts/2020/www-0x0e/>
<span class=title>« Prev</span>
<br>
<span>WWW 0x0E: 親愛的，我把快取都放你腦中了</span>
</a>
<a class=next href=https://weihanglo.tw/posts/2020/www-0x0c/>
<span class=title>Next »</span>
<br>
<span>WWW 0x0C: 未具名</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>CC BY-NC-SA 4.0</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>