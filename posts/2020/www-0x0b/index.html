<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>WWW 0x0B: 個資被偷和管理 DNS 紀錄，孰難孰易 | Life is a refactoring process without tests</title>
<meta name=keywords content="Weekly,Rust,Kubernetes,Privacy"><meta name=description content="Zoom 很讚，host 可以看你有沒有認真 — Zoom: Attendee attention tracking 這裡是 WWW 第拾壹期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初"><meta name=author content><link rel=canonical href=https://weihanglo.tw/posts/2020/www-0x0b/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://weihanglo.tw/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://weihanglo.tw/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://weihanglo.tw/favicon-32x32.png><link rel=apple-touch-icon href=https://weihanglo.tw/apple-touch-icon.png><link rel=mask-icon href=https://weihanglo.tw/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://weihanglo.tw/posts/2020/www-0x0b/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><meta property="og:title" content="WWW 0x0B: 個資被偷和管理 DNS 紀錄，孰難孰易"><meta property="og:description" content="Zoom 很讚，host 可以看你有沒有認真 — Zoom: Attendee attention tracking 這裡是 WWW 第拾壹期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初"><meta property="og:type" content="article"><meta property="og:url" content="https://weihanglo.tw/posts/2020/www-0x0b/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-04T00:00:00+08:00"><meta property="article:modified_time" content="2020-04-04T00:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="WWW 0x0B: 個資被偷和管理 DNS 紀錄，孰難孰易"><meta name=twitter:description content="Zoom 很讚，host 可以看你有沒有認真 — Zoom: Attendee attention tracking 這裡是 WWW 第拾壹期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://weihanglo.tw/posts/"},{"@type":"ListItem","position":2,"name":"WWW 0x0B: 個資被偷和管理 DNS 紀錄，孰難孰易","item":"https://weihanglo.tw/posts/2020/www-0x0b/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"WWW 0x0B: 個資被偷和管理 DNS 紀錄，孰難孰易","name":"WWW 0x0B: 個資被偷和管理 DNS 紀錄，孰難孰易","description":"Zoom 很讚，host 可以看你有沒有認真 — Zoom: Attendee attention tracking 這裡是 WWW 第拾壹期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初","keywords":["Weekly","Rust","Kubernetes","Privacy"],"articleBody":" Zoom 很讚，host 可以看你有沒有認真\n— Zoom: Attendee attention tracking\n這裡是 WWW 第拾壹期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。\nWhat future does the captical of Japan carry? Note: 東京不算是日本的「法定」首都\n這份簡報講解 Rust 最流行的非同步框架 Tokio 運作原理，透過圖像化的流程說明 future 如何於 Tokio 互動中被 poll 和 waken，非常直觀易理解，比敝人在 COSCUP 2019 的簡報 Our Future in Rust 好太多了。\nUsing Zoom? Here are the privacy issues you need to be aware of 因為疫情緣故，最近 Zoom 很夯，剛好有篇文章寫到 Zoom 有很多噁心有趣的 feature：\nhost 可以看參與者專不專心，超過 30 喵沒在看 zoom 就會 alert 會存一份聊天紀錄給 host，但沒說 private message 會不會給 host 宣稱蒐集名字、實體位置、email、電話、公司和職稱但不會拿去賣，只會用在「business purposes」 推薦有空看看這篇文章，尤其是「How you can protect your data」一節。\ncontroller.go:796] only numeric ports are allowed in ExternalName services: http is not valid as a TCP/UDP port 最近一些第三方服務需要設定 custom domain，DNS 簡單解決，但掛 SSL 憑證卻有點棘手，由於不想額外開一台 proxy server，決定使用 Plan A： 使用既有的 NGINX 。我們的 custom domain 需求是兩層 subdomain 的 one.two.example.com，而當前憑證是 *.example.com 的 wildcard certificate，原本以為可以成功掛憑證，卻一直沒有成功，後來才知道 wildcard certificate 只支援一層 subdomain。\nMatching is performed using the matching rules specified by [RFC2459]. If more than one identity of a given type is present in the certificate (e.g., more than one dNSName name, a match in any one of the set is considered acceptable.) Names may contain the wildcard character * which is considered to match any single domain name component or component fragment. E.g., *.a.com matches foo.a.com but not bar.foo.a.com. f*.com matches foo.com but not bar.com. 於是，改用 Plan B：Cloudflare 的 Universal SSL 免費掛憑證 ，嘗試將 DNS 導向 Cloudflare，卻發現 Universal SSL 也不支援 multi-level subdomain（除非付錢），只好 say goodbye。\n最後只能使出 Plan C：沿用在 Kubernetes 上的 NGINX Ingress Controller 。先將 DNS A record 導向 ingress controller，然後建立 ExternalName 的 service 指向第三方服務，再透過 cert-manager 發憑證。豈料一直無法成功掛上憑證，原來是 0.26.0 版之前的 NGINX Ingress Controller 的 Ingress 資源的 backend service 如果是 type ExternalName，就只能使用 numeric port，不能使用 IANA 定義的 named port，本來寫 backend.servicePort=http 只好改寫成 80 port。\n附上錯誤訊息：\nI0229 06:00:03.677872 6 controller.go:177] ingress backend successfully reloaded... W0229 06:00:06.744761 6 controller.go:796] only numeric ports are allowed in ExternalName services: http is not valid as a TCP/UDP port I0229 06:00:06.744977 6 controller.go:168] backend reload required I0229 06:00:06.979204 6 controller.go:177] ingress backend successfully reloaded... ","wordCount":"914","inLanguage":"en","datePublished":"2020-04-04T00:00:00+08:00","dateModified":"2020-04-04T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://weihanglo.tw/posts/2020/www-0x0b/"},"publisher":{"@type":"Organization","name":"Life is a refactoring process without tests","logo":{"@type":"ImageObject","url":"https://weihanglo.tw/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://weihanglo.tw/ accesskey=h title="Life is a refactoring process without tests (Alt + H)">Life is a refactoring process without tests</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://weihanglo.tw/ title=Home><span>Home</span></a></li><li><a href=https://weihanglo.tw/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://weihanglo.tw/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://weihanglo.tw/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">WWW 0x0B: 個資被偷和管理 DNS 紀錄，孰難孰易</h1><div class=post-meta><span title='2020-04-04 00:00:00 +0800 +0800'>April 4, 2020</span>&nbsp;·&nbsp;2 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-future-does-the-captical-of-japan-carryhttpsbitly2s7nwbl aria-label="What future does the captical of Japan carry?">What future does the captical of Japan carry?</a></li><li><a href=#using-zoom-here-are-the-privacy-issues-you-need-to-be-aware-ofhttpsprotonmailcomblogzoom-privacy-issues aria-label="Using Zoom? Here are the privacy issues you need to be aware of">Using Zoom? Here are the privacy issues you need to be aware of</a></li><li><a href=#controllergo796-only-numeric-ports-are-allowed-in-externalname-services-http-is-not-valid-as-a-tcpudp-porthttpsgithubcomkubernetesingress-nginxpull4449filesdiff-86ac9ff9d75a0c5005c116e766a6127dl851 aria-label="controller.go:796] only numeric ports are allowed in ExternalName services: http is not valid as a TCP/UDP port">controller.go:796] only numeric ports are allowed in ExternalName services: http is not valid as a TCP/UDP port</a></li></ul></div></details></div><div class=post-content><blockquote><p>Zoom 很讚，host 可以看你有沒有認真</p><p>— Zoom: Attendee attention tracking</p></blockquote><p>這裡是 WWW 第拾壹期，Wow Weihang Weekly 是一個毫無章法的個人週刊，出刊週期極不固定，從一週到五年都有可能。初期內容以軟體工程為主，等財富自由後會有更多雜食篇章。</p><h2 id=what-future-does-the-captical-of-japan-carryhttpsbitly2s7nwbl><a href=https://bit.ly/2S7NwbL>What future does the captical of Japan carry?</a><a hidden class=anchor aria-hidden=true href=#what-future-does-the-captical-of-japan-carryhttpsbitly2s7nwbl>#</a></h2><blockquote><p>Note: 東京不算是日本的「法定」首都</p></blockquote><p>這份簡報講解 Rust 最流行的非同步框架 <a href=https://tokio.rs/>Tokio</a> 運作原理，透過圖像化的流程說明 <code>future</code> 如何於 Tokio 互動中被 poll 和 waken，非常直觀易理解，比敝人在 COSCUP 2019 的簡報 <a href=https://weihanglo.tw/slides/coscup2019-our-future-in-rust.pdf>Our Future in Rust</a> 好太多了。</p><p><img loading=lazy src=https://rust-lang.github.io/futures-rs/assets/images/futures-rs-logo.svg alt></p><h2 id=using-zoom-here-are-the-privacy-issues-you-need-to-be-aware-ofhttpsprotonmailcomblogzoom-privacy-issues><a href=https://protonmail.com/blog/zoom-privacy-issues/>Using Zoom? Here are the privacy issues you need to be aware of</a><a hidden class=anchor aria-hidden=true href=#using-zoom-here-are-the-privacy-issues-you-need-to-be-aware-ofhttpsprotonmailcomblogzoom-privacy-issues>#</a></h2><p>因為疫情緣故，最近 Zoom 很夯，剛好有篇文章寫到 Zoom 有很多噁心有趣的 feature：</p><ul><li>host 可以看參與者專不專心，超過 30 喵沒在看 zoom 就會 alert</li><li>會存一份聊天紀錄給 host，但沒說 private message 會不會給 host</li><li>宣稱蒐集名字、實體位置、email、電話、公司和職稱但不會拿去賣，只會用在「business purposes」</li></ul><p>推薦有空看看這篇文章，尤其是「How you can protect your data」一節。</p><h2 id=controllergo796-only-numeric-ports-are-allowed-in-externalname-services-http-is-not-valid-as-a-tcpudp-porthttpsgithubcomkubernetesingress-nginxpull4449filesdiff-86ac9ff9d75a0c5005c116e766a6127dl851><a href=https://github.com/kubernetes/ingress-nginx/pull/4449/files#diff-86ac9ff9d75a0c5005c116e766a6127dL851>controller.go:796] only numeric ports are allowed in ExternalName services: http is not valid as a TCP/UDP port</a><a hidden class=anchor aria-hidden=true href=#controllergo796-only-numeric-ports-are-allowed-in-externalname-services-http-is-not-valid-as-a-tcpudp-porthttpsgithubcomkubernetesingress-nginxpull4449filesdiff-86ac9ff9d75a0c5005c116e766a6127dl851>#</a></h2><p>最近一些第三方服務需要設定 custom domain，DNS 簡單解決，但掛 SSL 憑證卻有點棘手，由於不想額外開一台 proxy
server，決定使用 <strong>Plan A： 使用既有的 NGINX</strong> 。我們的 custom domain 需求是兩層 subdomain 的 <code>one.two.example.com</code>，而當前憑證是 <code>*.example.com</code> 的 wildcard certificate，原本以為可以成功掛憑證，卻一直沒有成功，後來才知道 <a href=https://www.ietf.org/rfc/rfc2818.txt>wildcard certificate 只支援一層 subdomain</a>。</p><pre tabindex=0><code>Matching is performed using the matching rules specified by
[RFC2459].  If more than one identity of a given type is present in
the certificate (e.g., more than one dNSName name, a match in any one
of the set is considered acceptable.) Names may contain the wildcard
character * which is considered to match any single domain name
component or component fragment. E.g., *.a.com matches foo.a.com but
not bar.foo.a.com. f*.com matches foo.com but not bar.com.
</code></pre><p>於是，改用 <strong>Plan B：Cloudflare 的 Universal SSL 免費掛憑證</strong> ，嘗試將 DNS 導向 Cloudflare，卻發現 <a href=https://support.cloudflare.com/hc/en-us/articles/204151138-Understanding-Universal-SSL#h_408802647171549663799400>Universal SSL 也不支援 multi-level subdomain（除非付錢）</a>，只好 say goodbye。</p><p>最後只能使出 <strong>Plan C：沿用在 Kubernetes 上的 NGINX Ingress Controller</strong> 。先將 DNS A record 導向 ingress controller，然後建立 <code>ExternalName</code> 的 service 指向第三方服務，再透過 <a href=https://cert-manager.io/>cert-manager</a> 發憑證。豈料一直無法成功掛上憑證，原來是 0.26.0 版之前的 NGINX Ingress Controller 的 <code>Ingress</code> 資源的 backend service 如果是 type <code>ExternalName</code>，就只能使用 numeric port，不能使用 <a href=https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml>IANA 定義的 named port</a>，本來寫 <code>backend.servicePort=http</code> 只好改寫成 <code>80</code> port。</p><p>附上錯誤訊息：</p><pre tabindex=0><code>I0229 06:00:03.677872       6 controller.go:177] ingress backend successfully reloaded...
W0229 06:00:06.744761       6 controller.go:796] only numeric ports are allowed in ExternalName services: http is not valid as a TCP/UDP port
I0229 06:00:06.744977       6 controller.go:168] backend reload required
I0229 06:00:06.979204       6 controller.go:177] ingress backend successfully reloaded...
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://weihanglo.tw/tags/weekly/>Weekly</a></li><li><a href=https://weihanglo.tw/tags/rust/>Rust</a></li><li><a href=https://weihanglo.tw/tags/kubernetes/>Kubernetes</a></li><li><a href=https://weihanglo.tw/tags/privacy/>Privacy</a></li></ul><nav class=paginav><a class=prev href=https://weihanglo.tw/posts/2020/www-0x0c/><span class=title>« Prev</span><br><span>WWW 0x0C: 未具名</span>
</a><a class=next href=https://weihanglo.tw/posts/2020/www-0x0a/><span class=title>Next »</span><br><span>WWW 0x0A: 嗯，你這塊 0xDEADBEEF</span></a></nav></footer></article></main><footer class=footer><span>CC BY-NC-SA 4.0</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>