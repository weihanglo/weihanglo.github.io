<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>HLS 串流協議二三事 | Life is a refactoring process without tests</title>
<meta name=keywords content="HLS,Streaming">
<meta name=description content="最近開始研究很夯的直播技術，一般常見的直播方案為 HLS 以及 RTMP 等，本篇將介紹 Apple 強迫使用 大力支持的 HLS 協議。 （撰於 2017-04-10） 本文是兩年前的">
<meta name=author content>
<link rel=canonical href=https://weihanglo.tw/posts/2019/streamin-hls/>
<link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style>
<link rel=icon href=https://weihanglo.tw/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://weihanglo.tw/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://weihanglo.tw/favicon-32x32.png>
<link rel=apple-touch-icon href=https://weihanglo.tw/apple-touch-icon.png>
<link rel=mask-icon href=https://weihanglo.tw/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:!0},{left:'$',right:'$',display:!1},{left:'\\(',right:'\\)',display:!1},{left:'\\[',right:'\\]',display:!0}],throwOnError:!1})})</script>
<meta property="og:title" content="HLS 串流協議二三事">
<meta property="og:description" content="最近開始研究很夯的直播技術，一般常見的直播方案為 HLS 以及 RTMP 等，本篇將介紹 Apple 強迫使用 大力支持的 HLS 協議。 （撰於 2017-04-10） 本文是兩年前的">
<meta property="og:type" content="article">
<meta property="og:url" content="https://weihanglo.tw/posts/2019/streamin-hls/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-01-27T12:31:29+08:00">
<meta property="article:modified_time" content="2019-01-27T12:31:29+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="HLS 串流協議二三事">
<meta name=twitter:description content="最近開始研究很夯的直播技術，一般常見的直播方案為 HLS 以及 RTMP 等，本篇將介紹 Apple 強迫使用 大力支持的 HLS 協議。 （撰於 2017-04-10） 本文是兩年前的">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://weihanglo.tw/posts/"},{"@type":"ListItem","position":3,"name":"HLS 串流協議二三事","item":"https://weihanglo.tw/posts/2019/streamin-hls/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HLS 串流協議二三事","name":"HLS 串流協議二三事","description":"最近開始研究很夯的直播技術，一般常見的直播方案為 HLS 以及 RTMP 等，本篇將介紹 Apple 強迫使用 大力支持的 HLS 協議。 （撰於 2017-04-10） 本文是兩年前的","keywords":["HLS","Streaming"],"articleBody":"最近開始研究很夯的直播技術，一般常見的直播方案為 HLS 以及 RTMP 等，本篇將介紹 Apple 強迫使用 大力支持的 HLS 協議。\n（撰於 2017-04-10）\n 本文是兩年前的舊文，剛好最近又開始碰串流，所以拿出來獻醜一下。\n Overview HLS 的全名為 HTTP Live Streaming，是一個由 Apple 提出並實作。HLS 是基於 HTTP 的串流協議，實作起來平易近人。如果你想要實作串流但又不想要太複雜的後台配置、或是串流須經加密驗證，HLS 會是一個不錯的解決方案。\nWorkflow HLS 原理非常簡單：\n 將欲串流的影音媒體檔案進行對應編碼切割為一系列的影音串流片段（media segment，一般為 .ts 檔）。 建立索引檔（index file，為 .m3u8 檔）作為 HLS 的播放列表（playlist），指向多個影音串流片段的路徑 。 透過 HTTP 給予 client 對應的 Response（.m3u8、.ts）。 Client 請求並解析索引檔，即可開始串流，按照播放列表逐一下載播放串流片段。 該索引檔的播放列表（playlist）播完後，再請求新的索引檔，繼續串流。   簡單來講，就是取得 .m3u8 播放列表，按照順序播放 .ts 檔，全部放完再請求下一個 .m3u8 playlist，週而復始。\n Features HLS 定義許多機制，讓串流得以在各種惡劣的網路連線環境下生存。以下列出幾個 HLS 的重要特色：\nAdaptability and Availability .m3u8 這個 Playlist 檔除了指向影音串流片段路徑，也可以指向其他 Playlist 的路徑。標準架構是有一個 Master Playlist 指向其他的 Media Playlist（真正包含 .ts 的播放列表），達到自適應串流的結果。\n 自適應串流：根據使用者的頻寬與 CPU 負載，調整至不同 bitrate／影音品質（高清、普清）的串流，使串流體驗更加快速、穩定。\n 除了可以調整不同 bitrate，.m3u8 Playlist 尚可提供多個同內容但來源相異的串流，多個 server 同時待命，讓可憐的魯蛇工程師不再為 server 掛掉加班救台灣。\nBased on HTTP Protocol HLS 基於 HTTP Protocol，得以彌補其他非 HTTP-based 串流協議的缺點：\n 無須專門協議，可穿越大部分的 router／NAT／Firewall。 Server／Client 實作容易（支援 HTTP request/response 的 server 即可）。 可利用 HTTP-based CDN 作為 distribution server。  Content Protection HLS 有提供影音串流片段（Media Segments）個別加密，每個加密的片段需包含 #EXT-X-KEY tag，指向 decryption key 進行解碼。取得 decryption key 的方法則未加以限制，可有不同的認證／傳輸方式，端看如何實作（當然，建議使用 HTTPS 傳輸 key）。\nTwo Session Types HLS 分為兩種 session：**Video on Demand（VOD）**與 Live Sessions，除了一般的影音串流，更有直播模式可選擇，在此我們先將兩者粗分為 Static Mode 和 Live Mode。\n  VOD（Static Mode）:又稱為隨選視訊／視頻點播，是播放一個靜態、非直播的影音，相較於一般 H5 的 video tag 或 mp4，擁有動態切換 bitrate（自適應串流）以及驗證加密等技術。\n  Live Sessions（Live Mode）：顧名思義，就是一般認知的直播，如果 Playlist 不包含 #EXT-X-ENDLIST Tag，Client 將處於 live session，會不斷加載新的 index file（.m3u8）。\n  Architecture 概念上，HLS 的實作分為三個重要角色：\n Server Component - 負責影音前置作業的 server Distribution Component - 負責 serving file 的 HTTP server Client Software - 負責發送、接收、解析、並呈現串流的 client  蘋果親爹對該三角色的示意圖如下：\n以下介紹圖中三個要角的內容：\nServer Component 如圖所示，主要工作就是：「接受影音輸入，並將影音轉碼為 MPEG-2 Transport Stream 格式、最後分割為方便傳輸小片段」。此外，server 在切割片段時，必須產生對應的 Playlist（.m3u8），Playlist 內含有影音片段的有序播放列表。若檔案經過加密，server 需替 Playlist 注入對應的 #EXT-X-KEY tag，指明 decryption Key 的 URI。\nDistribution Component 就是一個 HTTP web Server，不需為了發送資料而自定義模組，透過簡單的 Request／Response，向 Clients 發送對應的影音媒體檔案。這個 HTTP Server 僅需簡單的配置，如將 MIME type 限制在 .m3u8 與 .ts 檔案。\nClient Software Client 的職責為解析索引檔（.m3u8），並依照索引檔提供的 URL 下載串流影音檔（.ts），串流檔下載足夠量時，組裝影音檔並呈現給用戶。\n在有需要時，Client 需實作切換不同品質／來源的串流源。若檔案經加密，Client 需依照索引檔的 URI 下載 decryption key 解密，並在必要時呈現認證畫面。\nReference  Apple - Streaming IETF Drafts - HTTP Live Streaming Wiki - HTTP Live Streaming Wiki - M3U HTTP Live Streaming (HLS) - 概念  ","wordCount":"1675","inLanguage":"en","datePublished":"2019-01-27T12:31:29+08:00","dateModified":"2019-01-27T12:31:29+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://weihanglo.tw/posts/2019/streamin-hls/"},"publisher":{"@type":"Organization","name":"Life is a refactoring process without tests","logo":{"@type":"ImageObject","url":"https://weihanglo.tw/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://weihanglo.tw accesskey=h title="Life is a refactoring process without tests (Alt + H)">Life is a refactoring process without tests</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://weihanglo.tw/ title=Home>
<span>Home</span>
</a>
</li>
<li>
<a href=https://weihanglo.tw/archives/ title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://weihanglo.tw/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://weihanglo.tw/about/ title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
HLS 串流協議二三事
</h1>
<div class=post-meta><span title="2019-01-27 12:31:29 +0800 +0800">January 27, 2019</span>&nbsp;·&nbsp;4 min
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#overview aria-label=Overview>Overview</a></li>
<li>
<a href=#workflow aria-label=Workflow>Workflow</a></li>
<li>
<a href=#features aria-label=Features>Features</a><ul>
<li>
<a href=#adaptability-and-availability aria-label="Adaptability and Availability">Adaptability and Availability</a></li>
<li>
<a href=#based-on-http-protocol aria-label="Based on HTTP Protocol">Based on HTTP Protocol</a></li>
<li>
<a href=#content-protection aria-label="Content Protection">Content Protection</a></li>
<li>
<a href=#two-session-types aria-label="Two Session Types">Two Session Types</a></li></ul>
</li>
<li>
<a href=#architecture aria-label=Architecture>Architecture</a><ul>
<li>
<a href=#server-component aria-label="Server Component">Server Component</a></li>
<li>
<a href=#distribution-component aria-label="Distribution Component">Distribution Component</a></li>
<li>
<a href=#client-software aria-label="Client Software">Client Software</a></li></ul>
</li>
<li>
<a href=#reference aria-label=Reference>Reference</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>最近開始研究很夯的直播技術，一般常見的直播方案為 <a href=https://en.wikipedia.org/wiki/HTTP_Live_Streaming>HLS</a> 以及 <a href=https://en.wikipedia.org/wiki/Real-Time_Messaging_Protocol>RTMP</a> 等，本篇將介紹 Apple <del>強迫使用</del> 大力支持的 HLS 協議。</p>
<p><em>（撰於 2017-04-10）</em></p>
<blockquote>
<p>本文是兩年前的舊文，剛好最近又開始碰串流，所以拿出來獻醜一下。</p>
</blockquote>
<h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2>
<p><strong>HLS</strong> 的全名為 <strong>HTTP Live Streaming</strong>，是一個由 Apple 提出並實作。HLS 是基於 HTTP 的串流協議，實作起來平易近人。如果你想要實作串流但又不想要太複雜的後台配置、或是串流須經加密驗證，HLS 會是一個不錯的解決方案。</p>
<h2 id=workflow>Workflow<a hidden class=anchor aria-hidden=true href=#workflow>#</a></h2>
<p>HLS 原理非常簡單：</p>
<ol>
<li>將欲串流的影音媒體檔案進行對應編碼切割為一系列的影音串流片段（media segment，一般為 <a href=https://en.wikipedia.org/wiki/MPEG_transport_stream>.ts 檔</a>）。</li>
<li>建立索引檔（index file，為 <a href=https://en.wikipedia.org/wiki/M3U>.m3u8 檔</a>）作為 HLS 的播放列表（playlist），指向多個影音串流片段的路徑 。</li>
<li>透過 HTTP 給予 client 對應的 Response（<strong>.m3u8</strong>、<strong>.ts</strong>）。</li>
<li>Client 請求並解析索引檔，即可開始串流，按照播放列表逐一下載播放串流片段。</li>
<li>該索引檔的播放列表（playlist）播完後，再請求新的索引檔，繼續串流。</li>
</ol>
<blockquote>
<p>簡單來講，就是取得 <strong>.m3u8</strong> 播放列表，按照順序播放 <strong>.ts</strong> 檔，全部放完再請求下一個 <strong>.m3u8</strong> playlist，週而復始。</p>
</blockquote>
<h2 id=features>Features<a hidden class=anchor aria-hidden=true href=#features>#</a></h2>
<p>HLS 定義許多機制，讓串流得以在各種惡劣的網路連線環境下生存。以下列出幾個 HLS 的重要特色：</p>
<h3 id=adaptability-and-availability>Adaptability and Availability<a hidden class=anchor aria-hidden=true href=#adaptability-and-availability>#</a></h3>
<p><code>.m3u8</code> 這個 Playlist 檔除了指向影音串流片段路徑，也可以指向其他 Playlist 的路徑。標準架構是有一個 <strong>Master Playlist</strong> 指向其他的 <strong>Media Playlist</strong>（真正包含 <strong>.ts</strong> 的播放列表），達到<a href=https://en.wikipedia.org/wiki/Adaptive_bitrate_streaming>自適應串流</a>的結果。</p>
<blockquote>
<p>自適應串流：根據使用者的頻寬與 CPU 負載，調整至不同 bitrate／影音品質（高清、普清）的串流，使串流體驗更加快速、穩定。</p>
</blockquote>
<p><img loading=lazy src=https://github.com/videojs/videojs-contrib-hls/raw/master/docs/hls-format.png alt>
</p>
<p>除了可以調整不同 bitrate，<code>.m3u8</code> Playlist 尚可提供多個同內容但來源相異的串流，多個 server 同時待命，讓可憐的魯蛇工程師不再為 server 掛掉加班救台灣。</p>
<h3 id=based-on-http-protocol>Based on HTTP Protocol<a hidden class=anchor aria-hidden=true href=#based-on-http-protocol>#</a></h3>
<p>HLS 基於 HTTP Protocol，得以彌補其他非 HTTP-based 串流協議的缺點：</p>
<ul>
<li><strong>無須專門協議</strong>，可穿越大部分的 router／NAT／Firewall。</li>
<li>Server／Client 實作容易（支援 HTTP request/response 的 server 即可）。</li>
<li>可利用 HTTP-based CDN 作為 distribution server。</li>
</ul>
<h3 id=content-protection>Content Protection<a hidden class=anchor aria-hidden=true href=#content-protection>#</a></h3>
<p>HLS 有提供影音串流片段（Media Segments）個別加密，每個加密的片段需包含 <strong>#EXT-X-KEY</strong> tag，指向 decryption key 進行解碼。取得 decryption key 的方法則未加以限制，可有不同的認證／傳輸方式，端看如何實作（當然，建議使用 HTTPS 傳輸 key）。</p>
<h3 id=two-session-types>Two Session Types<a hidden class=anchor aria-hidden=true href=#two-session-types>#</a></h3>
<p>HLS 分為兩種 session：**Video on Demand（VOD）**與 <strong>Live Sessions</strong>，除了一般的影音串流，更有直播模式可選擇，在此我們先將兩者粗分為 <strong>Static Mode</strong> 和 <strong>Live Mode</strong>。</p>
<ul>
<li>
<p><strong>VOD（Static Mode）</strong>:又稱為<strong>隨選視訊／視頻點播</strong>，是播放一個靜態、非直播的影音，相較於一般 H5 的 video tag 或 mp4，擁有動態切換 bitrate（自適應串流）以及驗證加密等技術。</p>
</li>
<li>
<p><strong>Live Sessions（Live Mode）</strong>：顧名思義，就是一般認知的直播，如果 Playlist 不包含 <code>#EXT-X-ENDLIST</code> Tag，Client 將處於 live session，會不斷加載新的 index file（<strong>.m3u8</strong>）。</p>
</li>
</ul>
<h2 id=architecture>Architecture<a hidden class=anchor aria-hidden=true href=#architecture>#</a></h2>
<p>概念上，HLS 的實作分為三個重要角色：</p>
<ul>
<li><strong>Server Component</strong> -> 負責影音前置作業的 server</li>
<li><strong>Distribution Component</strong> -> 負責 serving file 的 HTTP server</li>
<li><strong>Client Software</strong> -> 負責發送、接收、解析、並呈現串流的 client</li>
</ul>
<p>蘋果親爹對該三角色的示意圖如下：</p>
<p><img loading=lazy src=https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/StreamingMediaGuide/art/transport_stream_2x.png alt="HLS Basic">
</p>
<p>以下介紹圖中三個要角的內容：</p>
<h3 id=server-component>Server Component<a hidden class=anchor aria-hidden=true href=#server-component>#</a></h3>
<p>如圖所示，主要工作就是：「接受影音輸入，並將影音轉碼為 <a href=https://en.wikipedia.org/wiki/MPEG_transport_stream>MPEG-2 Transport Stream</a> 格式、最後分割為方便傳輸小片段」。此外，server 在切割片段時，必須產生對應的 Playlist（<strong>.m3u8</strong>），Playlist 內含有影音片段的有序播放列表。若檔案經過加密，server 需替 Playlist 注入對應的 <strong>#EXT-X-KEY</strong> tag，指明 decryption Key 的 URI。</p>
<h3 id=distribution-component>Distribution Component<a hidden class=anchor aria-hidden=true href=#distribution-component>#</a></h3>
<p>就是一個 HTTP web Server，不需為了發送資料而自定義模組，透過簡單的 Request／Response，向 Clients 發送對應的影音媒體檔案。這個 HTTP Server 僅需簡單的配置，如將 MIME type 限制在 <strong>.m3u8</strong> 與 <strong>.ts</strong> 檔案。</p>
<h3 id=client-software>Client Software<a hidden class=anchor aria-hidden=true href=#client-software>#</a></h3>
<p>Client 的職責為解析索引檔（<strong>.m3u8</strong>），並依照索引檔提供的 URL 下載串流影音檔（<strong>.ts</strong>），串流檔下載足夠量時，組裝影音檔並呈現給用戶。</p>
<p>在有需要時，Client 需實作切換不同品質／來源的串流源。若檔案經加密，Client 需依照索引檔的 URI 下載 decryption key 解密，並在必要時呈現認證畫面。</p>
<h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2>
<ul>
<li><a href=https://developer.apple.com/streaming/>Apple - Streaming</a></li>
<li><a href=https://tools.ietf.org/html/draft-pantos-http-live-streaming>IETF Drafts - HTTP Live Streaming</a></li>
<li><a href=https://en.wikipedia.org/wiki/HTTP_Live_Streaming>Wiki - HTTP Live Streaming</a></li>
<li><a href=https://en.wikipedia.org/wiki/M3U>Wiki - M3U</a></li>
<li><a href=https://www.jianshu.com/p/2ce402a485ca>HTTP Live Streaming (HLS) - 概念</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://weihanglo.tw/tags/hls/>HLS</a></li>
<li><a href=https://weihanglo.tw/tags/streaming/>Streaming</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://weihanglo.tw/posts/2019/design-patterns-for-managing-up/>
<span class=title>« Prev</span>
<br>
<span>向上管理的設計模式</span>
</a>
<a class=next href=https://weihanglo.tw/posts/2018/rust-ownership-and-references/>
<span class=title>Next »</span>
<br>
<span>Rust: Ownership and References</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>CC BY-NC-SA 4.0</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>